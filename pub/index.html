<!DOCTYPE html>
<html>
<head>
    <title>Chess</title>
    <style>
        * {
            margin: 0px;
            padding: 0px;
        }
        p {
            font-family: "Arial";
            font-size: 24px;
            color: #EEEED2;
            margin-top: 10px;
            margin-left: 10px;
        }
    </style>
</head>
<body style="background-color: #272522">

    <canvas id="canv_board"></canvas>
    <p id="status">In queue</p>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const WHITE_KING = 1;
        const BLACK_KING = 2;
        const WHITE_QUEEN = 3;
        const BLACK_QUEEN = 4;
        const WHITE_BISHOP = 5;
        const BLACK_BISHOP = 6;
        const WHITE_KNIGHT = 7;
        const BLACK_KNIGHT = 8;
        const WHITE_ROOK = 9;
        const BLACK_ROOK = 10;
        const WHITE_PAWN = 11;
        const BLACK_PAWN = 12;
        
        const BOARD_SIZE = 800;
        const TILE_SIZE = BOARD_SIZE / 8;

        const socket = io();
        let board = [];
        let images = [];
        let is_player = false;

        window.onload = function() {
            status_p = document.getElementById("status");
            canv = document.getElementById("canv_board");
            canv.width = BOARD_SIZE;
            canv.height = BOARD_SIZE;

            ctx = canv.getContext("2d");

            init_game();
            load_images();
            setInterval(loop, 1000 / 60);
        }

        function init_game() {
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    board.push(0);
                }
            }
        }

        function loop() {
            for (let y = 0; y < 8; y++) {
                for (let x = 0; x < 8; x++) {
                    if ((x + y) % 2 == 0) {
                        ctx.fillStyle = "#EEEED2";
                    } else {
                        ctx.fillStyle = "#769656";
                    }
                    ctx.fillRect(x * TILE_SIZE, y * TILE_SIZE, TILE_SIZE, TILE_SIZE);            
                }
            }
        }

        socket.on("update-board", (data) => {
            console.log(data.board);
        });

        socket.on("set-color", (color) => {
            if (color == "white" || color == "black") {
                status_p.innerText = color;
                is_player = true;
            } else {
                status_p.innerText = "In queue";
                is_player = false;
            }
        });

        function load_images() {
            // King Queen Knight Bishop Rook Pawn
            images.push(null);
            images.push(load_image("WhiteQueen"));
            images.push(load_image("BlackKing"));
            images.push(load_image("WhiteQueen"));
            images.push(load_image("BlackQueen"));
            images.push(load_image("WhiteBishop"));
            images.push(load_image("BlackBishop"));
            images.push(load_image("WhiteKnight"));
            images.push(load_image("BlackKnight"));
            images.push(load_image("WhiteRook"));
            images.push(load_image("BlackRook"));
            images.push(load_image("WhitePawn"));
            images.push(load_image("BlackPawn"));
        }

        function load_image(name) {
            let image = new Image();
            image.src = "/rsc/" + name + ".png";
            return image;
        }
    </script>
</body>
</html>
